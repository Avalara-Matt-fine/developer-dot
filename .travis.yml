language: ruby
rvm:
  - 2.1

before_install:
  - nvm install 6.0
install:
  - gem install jekyll
  - gem install s3_website
script:
  - npm install
  - bundle install
  - npm run build && bundle exec jekyll build
after_success:
  - if [ -n "$ALGOLIA_API_KEY" ]; then bundle exec jekyll algolia push; fi
deploy:
  # deploy master to production
  - provider: script
    skip_cleanup: true
    script: bucket_name=developer.avalara.com scripts/deploy.sh
    on:
      branch: master
  # deploy master to production
  # - provider: script
  #   all_branches: true
  #   script: echo "hi"
  #   on:
  #     condition: "$TRAVIS_BRANCH != master"